\chapter{Fluxo de potência por varredura}\label{chp:fluxo}

\section{Modelagem matemática}
Para o estudo do fluxo de potência, é preciso realizar a modelagem matemática dos componentes reais do sistema. Os modelos apresentados nesta seção consideram a operação estática do sistema e sem interferência da frequência da tensão de suprimento.


\subsection{Linhas trifásicas}\label{subsec:linha}
As linhas nas redes de distribuição são, geralmente, modeladas utilizando o modelo de linha curta para as redes primárias e secundárias e o de linha média ($\pi$ nominal) para as redes de subtransmissão \cite{Kagan}.

Neste trabalho é utilizado o modelo de linha curta a três fios, considerando o efeito do acoplamento entre as linha. Assim, a linha de transmissão pode ser representada graficamente conforme a figura \ref{fig:linha-tri}.

\begin{figure}[h]
    \centering
    \caption{Representação de uma linha trifásica conectando as barras \textit{i} e \textit{j}.}
    \includegraphics[scale=0.4]{linha-tri}
    \label{fig:linha-tri}
    
    \small Fonte: Autoria própria.
\end{figure}
        
O modelo matemático utilizado para descrever a linha que conecta as barras \textit{i} e \textit{j} se dá na seguinte forma matricial:

\[
\mathbf{Z}_{ij} = 
\left[ \begin{matrix}
Z_{aa} & Z_{ab} & Z_{ac} \\
Z_{ba} & Z_{bb} & Z_{bc} \\
Z_{ca} & Z_{cb} & Z_{cc} \\
\end{matrix} \right]
\].

Onde os elementos $Zaa$, $Zbb$ e $Zcc$ são a impedância própria das fases \textit{a}, \textit{b} e \textit{c}, respectivamente, e os outros elementos são a impedância do acoplamento entre as fases.

\subsection{Linha bifásica ou monofásica}

As linhas bifásicas e monofásicas são representadas da mesma forma que as linhas trifásicas, porém, os elementos que compõem a matriz impedância $\mathbf{Z}$, para as fases faltantes, são considerados zero.

\subsection{Cargas e geradores}
As cargas e os geradores são modelados considerando a conexão em estrela, sendo que, para cargas bifásicas ou monofásicas, é considerado que a corrente nas fases faltantes é zero. Este trabalho utiliza somente cargas que possuem potência constante.

A notação utilizada para descrever a potência complexa $\mathbf{S}$ das cargas e geradores conectados na barra \textit{i} é:

\[
\mathbf{S}_i = 
\left[ \begin{matrix}
S_{ia}\\
S_{ib}\\
S_{ic}\\
\end{matrix} \right] = 
\left[ \begin{matrix}
P_{ia} + jQ_{ia}\\
P_{ib} + jQ_{ib}\\
P_{ic} + jQ_{ic}\\
\end{matrix} \right]
\].

Onde $P$ é a potência real e $Q$ é a potência reativa.

\subsection{Capacitores \textit{Shunt}}
Os elementos \textit{shunt} também são considerados como tendo potência constante. A notação utilizada para descrever-los é a mesma para as cargas e geradores.

\section{Método da soma das potências}

O método da soma das potências, originalmente proposto por \cite{Cespedes}, se baseia na eliminação do ângulo de fase nas equações do fluxo de potência para simplificar a resolução do problema. Na maioria dos estudos relacionados ao fluxo de potência, o ângulo da tensão não é significante, sendo analisado somente o módulo da tensão que chega aos consumidores. Caso seja necessário, o ângulo pode ser determinado com a adição de mais uma etapa de varredura. 

O algoritmo consiste em duas operações, uma a montante, ou seja, a partir dos nós mais distantes da barra de referência, e uma operação a jusante, partindo da barra de referência até as barras finais.

Na operação a montante, são calculadas as potências equivalentes em cada nó, i.e., somando somando todas as potências que são alimentadas através da barra, incluindo as perdas.

Assim, primeiro é calculada a potência na barra através da equação \ref{equ:scespedes}, até a barra inicial.

\begin{equation}
\mathbf{S}_{i}^{equivalente} = \mathbf{S}_i + \sum_{m \, \in \, M}(\mathbf{S}_m + \mathbf{L}_m).
\label{equ:scespedes}
\end{equation}

Onde $\sum(\mathbf{S}_m + \mathbf{L}_m)$ é a soma das potência e perdas no conjunto de linhas M, que saem da barra \textit{i} para as barras à montante.

Na operação à jusante, partindo da barra inicial, é determinado o valor absoluto da tensão em cada barra com o uso da equação \ref{equ:vcespedes} ou \ref{equ:vcespedes2}.


\begin{figure}[h]
    \centering
    \caption{Conexão entre as barras \textit{s} e \textit{r}.}
    \includegraphics[scale=0.4]{cespedes}
    \label{fig:cespedes}
    
    \small Fonte: Autoria própria.
\end{figure}

\begin{equation}
\label{equ:vcespedes}
|V_{r}|^4 + (2\mathfrak{Re} \{S^* \cdot Z\} - |V_{s}|^2)|V_{r}|^2 + \mathfrak{Re} \{S^* \cdot Z\}^2 + 
\mathfrak{Im} \{S^* \cdot Z\}^2 = 0    
\end{equation}

\begin{equation}
\label{equ:vcespedes2}
|V_r|^4 + [2 \cdot (PR+QX) -  |V_s|^2] \cdot  |V_r|^2 + (P^2 + Q^2) \cdot (R^2 + X^2) = 0.  
\end{equation}

Onde:
\begin{itemize}
    \item \emph{s} é o nó fonte e \emph{r} é o nó à jusante;
    \item \emph{$V_s$} é o módulo da tensão em \emph{s};
    \item \emph{$V_r$} é o módulo da tensão em \emph{r};
    \item \emph{P} e \emph{Q} são as potências ativa e reativa equivalentes da carga;
    \item \emph{R} é a resistência e \emph{X} a reatância da linha de transmissão;
\end{itemize}

A equação \ref{equ:vcespedes} surge da aplicação direta da Lei de Ohm ao sistema da figura \ref{fig:cespedes}.

Ao final da operação a jusante, as perdas são atualizadas através da equação \ref{equ:lcespedes}.

 \begin{eqnarray}
 \label{equ:lcespedes}
 L_p = R \frac{(P^2 + Q^2)}{V_r^2} \\
 L_q = X \frac{(P^2 + Q^2)}{V_r^2}
 \end{eqnarray}

Sendo \emph{$L_p$} e \emph{$L_q$} as perdas ativas e reativas, respectivamente.

É dito que o algoritmo convergiu quando a variação das perdas totais, entre uma iteração e outra, é menor que um fator de tolerância $\epsilon$.

O ângulo das tensões pode ser calculado, com outra operação a jusante, a partir da equação \ref{equ:thcespedes}.

\begin{equation}
\label{equ:thcespedes}
\delta_s = \delta_r - cos^{-1} \left( \sqrt{1 - \left( \frac{XP + RQ}{|V_s||V_r|} \right)}\right)
\end{equation}

Sendo $\delta_s$ o ângulo da tensão na barra \textit{s} e $\delta_r$ o ângulo da tensão na barra \textit{r}.

Segundo \citeonline{Ochoa}, o método não considera o acoplamento entre as linhas, sendo aplicado em paralelo para cada uma das fases. Um método para compensação parcial é proposto por \cite{Ramos}, porém não foi explorado nesse trabalho.

Outro problema apresentado pelo método é que ele não pode ser executado em redes malhadas, tornando-o limitado para aplicações em sistemas reais.

\section{Método da soma das correntes}

Esse método, proposto originalmente para redes monofásicas \cite{Shirmohammad} e depois adaptado para redes trifásicas \cite{Shirmohammad3F}, utiliza a soma das correntes nas linhas para determinar o fluxo de potência.
Semelhante ao método da soma das potências, o algoritmo consiste em duas varreduras, denominadas \textit{backward sweep} e \textit{forward sweep}, sendo uma à montante e outra à jusante.

Uma das vantagens do método da soma das correntes é que o mesmo pode ser aplicado a redes fracamente malhadas. Outra vantagem é que o algoritmo possui compensação para o acoplamento entre as linhas, levando a resultados mais precisos.

A execução do algoritmo segue os passos a seguir:

\begin{enumerate}
  \item Primeiro, é assumir um perfil de tensão inicial para as barras, geralmente 1 pu.
  
  \item O próximo passo é determinar a corrente nas barras através da equação \ref{equ:ishirm}.
  
  \begin{equation}
  \label{equ:ishirm}
  \left[ \begin{matrix}
  I_{ia} \\
  I_{ib} \\
  I_{ic} \\
  \end{matrix} \right]^{(k)} = 
  \left[ \begin{matrix}
  \left(\frac{S_{ia}}{V_{ia}^{(k-1)}}\right)^* \\
  \left(\frac{S_{ib}}{V_{ib}^{(k-1)}}\right)^* \\
  \left(\frac{S_{ic}}{V_{ic}^{(k-1)}}\right)^* \\
  \end{matrix} \right] - 
  \left[ \begin{matrix}
  Y_{ia}^* & 0 & 0 \\
  0 & Y_{ib}^* & 0 \\
  0 & 0 & Y_{ic}^* \\
  \end{matrix} \right]
  \left[ \begin{matrix}
  V_{ia} \\
  V_{ib} \\
  V_{ic} \\
  \end{matrix} \right]^{(k-1)}
  \end{equation}
  
  Onde:
  \begin{itemize}
    \item $I_{ia}$, $I_{ib}$ e $I_{ic}$ são as correntes injetadas na barra \textit{i};
    
    \item $S_{ia}$, $S_{ib}$ e $S_{ic}$ são as potências injetadas na barra \textit{i};
    
    \item $V_{ia}$, $V_{ib}$ e $V_{ic}$ são as tensões na barra \textit{i};
    
    \item $Y_{ia}$, $Y_{ib}$ e $Y_{ic}$ é a admitância dos elementos \textit{shunt} conectados a barra \textit{i};
    
    \item \textit{k} é a iteração.
  \end{itemize}
  
  \item Em seguida, é iniciada a operação à montante, onde, partindo dos nós finais até a barra inicial, é calculada a corrente nas linhas com a equação \ref{equ:ilshirm}.
  
  \begin{equation}
  \label{equ:ilshirm}
  \left[ \begin{matrix}
  J_{la} \\
  J_{lb} \\
  J_{lc} \\
  \end{matrix} \right]^{(k)} = -
  \left[ \begin{matrix}
  I_{ia} \\
  I_{ib} \\
  I_{ic} \\
  \end{matrix} \right]^{(k)} +
  \sum_{m \, \in \, M}
  \left[ \begin{matrix}
  J_{ma} \\
  J_{mb} \\
  J_{mc} \\
  \end{matrix} \right]^{(k)}
  \end{equation}
  
  Onde $ J_{la} $, $ J_{lb} $ e $ J_{lc} $ são as correntes na linha \textit{l} e  $ J_{ma} $, $ J_{mb} $ e $ J_{mc} $ as correntes na linha m, sendo m o conjunto de linha que emanam à jusante da barra \textit{i}.
  
  \item Após o cálculo das correntes de linha, é executada a operação à jusante, utilizando a equação \ref{equ:vshirm} para aplicar a correção de tensão nas barras.
  
  \begin{equation}
  \label{equ:vshirm}
  \left[ \begin{matrix}
  V_{ja} \\
  V_{jb} \\
  V_{jc} \\
  \end{matrix} \right]^{(k)} = 
  \left[ \begin{matrix}
  V_{ia} \\
  V_{ib} \\
  V_{ic} \\
  \end{matrix} \right]^{(k)} -
  \left[ \begin{matrix}
  Z_{aa} & Z_{ab} & Z_{ac} \\
  Z_{ba} & Z_{bb} & Z_{bc} \\
  Z_{ca} & Z_{cb} & Z_{cc} \\
  \end{matrix} \right]
  \left[ \begin{matrix}
  J_{la} \\
  J_{lb} \\
  J_{lc} \\
  \end{matrix} \right]^{(k)}
  \end{equation}
  
  \item O critério de convergência é determinado a partir da variação da potência nas barras (equação \ref{equ:cvshirm}). Se a parte real ($P$) ou a parte imaginária ($Q$) de qualquer uma das variações de potência ($\Delta \mathbf{S}_i$) na equação \ref{equ:cvshirm} for maior que o fator de tolerância $\epsilon$, os passos de 2, 3 e 4 são executados novamente, até que se obtenha a convergência ou que atinga um número máximo de iterações.
  
    \begin{equation}
    \label{equ:cvshirm}
    \left[ \begin{matrix}
    \Delta S_{ia} \\
    \Delta S_{ib} \\
    \Delta S_{ic} \\
    \end{matrix} \right]^{(k)} = 
    \left[ \begin{matrix}
    V_{ia} \\
    V_{ib} \\
    V_{ic} \\
    \end{matrix} \right]^{(k)}
    \left[ \begin{matrix}
    I_{ia}^* \\
    I_{ib}^* \\
    I_{ic}^* \\
    \end{matrix} \right]^{(k)} -
    \left[ \begin{matrix}
    Y_{ia}^* & 0 & 0 \\
    0 & Y_{ib}^* & 0 \\
    0 & 0 & Y_{ic}^* \\
    \end{matrix} \right]
    \left[ \begin{matrix}
    |V_{ia}|^2 \\
    |V_{ib}|^2 \\
    |V_{ic}|^2 \\
    \end{matrix} \right]^{(k)} -
    \left[ \begin{matrix}
    S_{ia} \\
    S_{ib} \\
    S_{ic} \\
    \end{matrix} \right]
    \end{equation}
\end{enumerate}


\section{Renumeração das barras}
Em ambos os métodos de cálculo do fluxo de potência, é necessário uma renumeração das barras, de modo a deixar o sistema em uma representação adequada para a execução do algoritmo.

Neste trabalho foi empregada uma abordagem orientada a objetos, onde não é necessário a renumeração das barras. Para representar a estrutura da rede, é utilizada uma técnica que se assemelha a uma lista ligada (\textit{linked list}) \cite{Cormen}. Assim, cada objeto barra possui uma lista de objetos linha a qual está conectado. As linhas, por sua vez, possuem uma referência a duas barras, denominadas nó inicial e nó final.

Dessa forma, não é necessário renumerar o sistema, pois a navegação é realizada através da referência aos objetos barra e linha.

Para agilizar o acesso aleatório a uma barra, i.e. acessar uma barra sem a necessidade de percorrer toda a lista, é utilizada uma estrutura do tipo \textit{Hash Table} \cite{Cormen}, a qual permite buscar o endereço da barra, a partir do seu número, ou o endereço da linha, de acordo com seus nós inicial e final. 

Na abordagem tradicional, a rede é representada usando vetores, dificultando a remoção e inserção de elementos, aumentando ainda mais o custo computacional para aplicação do algoritmo de otimização. A abordagem empregada facilita a utilização do algoritmo de redução de barras, visto que para remover ou inserir um elemento, é necessário somente alterar uma referência (ponteiro em C++), sem precisar movimentar uma grande quantidade de dados na memória. 










